
# LGVS-Server-Lobby

[凉糕对战平台大厅服务端](https://github.com/BadFishy/LGVS-Server-Login)

## 运作原理流程

### 一、初始化

#### 1. 启动日志

日志目录不存在则在运行目录下创建log文件夹

#### 2. 检测配置文件 config.ini 是否存在

若不存在则提示修改 config_origin.ini 内的配置后将其更名为 config.ini

### 二、开始

#### 1. 加载配置文件

初始化Config类，加载配置文件

#### 2. 连接数据库

##### 若数据库未初始化

（配置文件中的 INIT = 0)

###### - 新建数据表 USER

（具体的列参考 LGVS数据库.xls）

###### - 然后将 INIT = 1 后自动重启程序

#### 3. 创建大厅服务器线程

## 大厅服务器线程

### 一、初始化并建立TCP服务端
默认监听10199端口

### 二、等待用户连接

#### 1. 建立连接

#### 2. 发送识别符
发送 LGVS_Login 字符

#### 3. 握手成功接收客户端发来的请求
格式为 xxx,xxx,xxx,...
其中第一项为事件标识
若为 reg 则为注册
若为 login 则为登陆

#### 4. 处理事件
##### 登陆
###### 1) 在数据库中查找用户名
存在则继续 不存在则返回2
###### 2) 在数据库中匹配用户名和密码
成功则返回1 不成功则返回3

##### 注册
###### - 在数据库中查找是否已存在用户名
存在则返回5 不存在则填入数据表

#### 5. 返回值
登陆或注册请求处理后向客户端发送对应的值

```C++
/**
*	jieshou(char*) 返回的值
*	1. 登陆成功
*	2. 登陆失败用户名不存在
*	3. 登陆失败密码错误
*	4. 注册成功
*	5. 注册失败用户名已存在
*	6. 注册失败数据库插入失败
*/
```
#### 6. 完成事件
### 三、 等待用户连接……（返回步骤二）